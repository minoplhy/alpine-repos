maintainer="Minoplhy <c@3qx.nl>"
pkgname=opengist
pkgver=1.11.1
pkgrel=0
pkgdesc="Self-hosted pastebin powered by Git, open-source alternative to Github Gist."
url="https://opengist.io/"
arch="x86_64"
license="AGPL-3.0"
makedepends="go npm nodejs"
pkgusers="opengist"
pkggroups="opengist"
install="$pkgname.pre-install"
subpackages="
    $pkgname-openrc
    "
source="$pkgname-$pkgver.tar.gz::https://github.com/thomiceli/opengist/archive/refs/tags/v$pkgver.tar.gz
	$pkgname.initd
    "
options="net !check" # check: no test suite

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

build() {
    npm install vite
    make build
}

package() {
	install -Dm755 opengist "$pkgdir"/usr/bin/opengist
    
    install -d -m 750 -o $pkgusers -g $pkggroups "$pkgdir"/var/lib/opengist
	install -D -m 755 "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
    install -d -m 740 "$pkgdir"/etc/$pkgname
    install -d -m 755 -o $pkgusers -g $pkggroups "$pkgdir"/var/log/$pkgname
}

sha512sums="
2ab7a51ff593eaa67c44706a817923db427e4513b238240e150f547b46da525c98acc913157303f10c5f9f542d69bd2a9dbf07c741fc0463d96e6725b67cf837  opengist-1.11.0.tar.gz
b939d6c014c588d5a7c3ee823e5d94711948dbd72ab6250bc6822369b11ff59fd87c320dfdb4efecbd9f70c376cbcdae3efd41b118e41976ed2e37ab3179812b  opengist.initd
"
